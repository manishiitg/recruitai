version: '3.8'

services:
    # resumemq:
    #     image: recruitai/resumemq:latest
    #     build: microservice/resume
        
    #     volumes:
    #         - ./pretrained:/workspace/pretrained:ro
    #         - /var/log/recruitai:/workspace/logs  
    #         - ./microservice/resume/app:/workspace/app            
    #     environment:
    #         RABBIT_DB: amqp://rabbitmq?connection_attempts=5&retry_delay=5&heartbeat=3600
    #         RESUME_PARALLEL_PROCESS: 1
    #     networks:
    #         - ai
    
    picturemq:
        image: recruitai/picture:gpu
        build:
            dockerfile: Dockerfile.gpu
            context: microservice/picture
        volumes:
            - ./pretrained:/workspace/pretrained:ro
            - ./cvreconstruction:/workspace/cvreconstruction 
            - /var/log/recruitai:/workspace/logs  
            - ./microservice/picture/app:/workspace/app            
        

    summarymq:
        image: recruitai/summary:gpu
        build:
            dockerfile: Dockerfile.gpu
            context: microservice/summary
        device_requests:
            - capabilities:
                - gpu
        volumes:
            - ./pretrained:/workspace/pretrained:ro
            - ./cvreconstruction:/workspace/cvreconstruction 
            - /var/log/recruitai:/workspace/logs  
            - ./microservice/summary/app:/workspace/app            
        environment:
            RABBIT_DB: amqp://rabbitmq?connection_attempts=5&retry_delay=5
        